name: evpn-fabric-v11
prefix: evpn

mgmt:
  network: evpn-mgmt
  ipv4-subnet: 172.20.21.0/24

topology:
  kinds:
    linux:
      image: frrouting/frr:9.0.2
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs:/etc/frr
    host:
      image: alpine:3.20
      binds:
        - ./scripts:/opt/scripts

  nodes:
    spine1: { kind: linux, cmd: /bin/sh -lc "(frr_exporter --telemetry.addr=:9342 &) && /usr/lib/frr/docker-start" }
    spine2: { kind: linux, cmd: /bin/sh -lc "(frr_exporter --telemetry.addr=:9342 &) && /usr/lib/frr/docker-start" }
    leaf1:  { kind: linux, cmd: /bin/sh -lc "(frr_exporter --telemetry.addr=:9342 &) && /usr/lib/frr/docker-start" }
    leaf2:  { kind: linux, cmd: /bin/sh -lc "(frr_exporter --telemetry.addr=:9342 &) && /usr/lib/frr/docker-start" }
    leaf3:  { kind: linux, cmd: /bin/sh -lc "(frr_exporter --telemetry.addr=:9342 &) && /usr/lib/frr/docker-start" }
    srv1:   { kind: host }

  links:
    - endpoints: [leaf1:eth1, spine1:eth1]
    - endpoints: [leaf1:eth2, spine2:eth1]
    - endpoints: [leaf2:eth1, spine1:eth2]
    - endpoints: [leaf2:eth2, spine2:eth2]
    - endpoints: [leaf3:eth1, spine1:eth3]
    - endpoints: [leaf3:eth2, spine2:eth3]
    - endpoints: [srv1:eth1, leaf1:eth10]
    - endpoints: [srv1:eth2, leaf2:eth10]
